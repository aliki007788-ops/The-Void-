<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE VOID - ETERNAL ASCENSION</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;700;900&display=swap');
        
        :root {
            --gold-primary: #D4AF37;
            --gold-light: #F9F1D0;
            --gold-dark: #AA8800;
            --void-black: #050505;
            --glass-bg: rgba(20, 20, 20, 0.95);
            --glass-border: rgba(212, 175, 55, 0.4);
            --text-gold: #FFD700;
            --text-muted: rgba(255, 255, 255, 0.6);
            --accent-glow: rgba(212, 175, 55, 0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            width: 100%; height: 100%; overflow: hidden;
            background: var(--void-black);
            color: var(--gold-light);
            font-family: 'Cinzel', serif;
            perspective: 1000px;
        }

        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }

        /* Navigation UI */
        .nav-trigger {
            position: fixed; top: 20px; right: 20px; z-index: 2000;
            width: 50px; height: 50px; cursor: pointer;
            display: flex; flex-direction: column; justify-content: center; align-items: flex-end;
            gap: 6px; mix-blend-mode: difference;
        }
        .bar {
            height: 2px; background: var(--gold-primary); 
            transition: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 0 8px var(--gold-primary);
        }
        .bar:nth-child(1) { width: 40px; }
        .bar:nth-child(2) { width: 30px; }
        .bar:nth-child(3) { width: 20px; }
        
        .nav-trigger.active .bar:nth-child(1) { transform: rotate(45deg) translate(8px, 8px); width: 40px; }
        .nav-trigger.active .bar:nth-child(2) { opacity: 0; }
        .nav-trigger.active .bar:nth-child(3) { transform: rotate(-45deg) translate(5px, -6px); width: 40px; }

        .bottom-nav-bar {
            position: fixed; bottom: 30px; left: 3%; width: 94%; height: 75px;
            background: rgba(10, 10, 10, 0.98); border: 1px solid var(--gold-primary);
            border-radius: 50px; display: flex; flex-direction: row;
            justify-content: space-between; align-items: center; padding: 0 15px;
            z-index: 1500; backdrop-filter: blur(25px);
            box-shadow: 0 0 50px rgba(0,0,0,1), 0 0 20px var(--accent-glow);
            transform: translateY(150%); opacity: 0;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .bottom-nav-bar.active { transform: translateY(0); opacity: 1; }

        .nav-item {
            color: var(--text-muted); font-size: 0.6rem; font-weight: 700;
            text-align: center; cursor: pointer; transition: 0.3s; letter-spacing: 1.5px;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            padding: 10px 5px; flex: 1;
        }
        .nav-item:hover { color: var(--gold-primary); text-shadow: 0 0 10px var(--gold-primary); }

        /* Stages & Sections */
        .stage, .section-container {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10; padding: 25px; transition: all 0.8s ease;
        }
        .section-container { display: none; padding-top: 100px; justify-content: flex-start; overflow-y: auto; }

        /* Typography */
        .main-title {
            font-size: clamp(3rem, 12vw, 5rem); letter-spacing: 15px; font-weight: 900;
            color: transparent; background: linear-gradient(135deg, #F9F1D0, #D4AF37, #AA8800, #F9F1D0);
            background-clip: text; -webkit-background-clip: text;
            text-shadow: 0 0 25px rgba(212, 175, 55, 0.6);
            margin-bottom: 60px; text-align: center; animation: titleGlow 5s infinite alternate;
        }
        @keyframes titleGlow {
            0% { filter: drop-shadow(0 0 10px rgba(212,175,55,0.5)); transform: scale(1); }
            100% { filter: drop-shadow(0 0 30px rgba(212,175,55,0.8)); transform: scale(1.02); }
        }

        .section-title {
            font-size: 2rem; letter-spacing: 8px; color: var(--gold-primary);
            margin-bottom: 40px; text-align: center; font-weight: 900;
        }

        /* Inputs & Buttons */
        .input-wrapper { width: 90%; max-width: 400px; margin: 40px 0; position: relative; }
        .sacrifice-input {
            background: transparent; border: none; border-bottom: 1px solid var(--gold-dark);
            color: #fff; font-size: 1.4rem; text-align: center; width: 100%; padding: 15px 0;
            font-family: 'Cinzel', serif; letter-spacing: 4px; outline: none; transition: 0.5s;
        }
        .sacrifice-input:focus { border-bottom: 2px solid var(--gold-primary); box-shadow: 0 10px 20px -10px var(--gold-primary); }

        .ascend-btn {
            background: rgba(0,0,0,0.4); border: 2px solid var(--gold-primary);
            color: var(--gold-primary); padding: 25px 70px; font-size: 1.6rem;
            letter-spacing: 8px; cursor: pointer; transition: 0.5s;
            font-family: 'Cinzel', serif; font-weight: 900; border-radius: 60px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.2);
        }
        .ascend-btn:active { transform: scale(0.95); background: var(--gold-primary); color: #000; }

        /* Cards & Tabs */
        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border); border-radius: 15px;
            width: 100%; max-width: 450px; overflow: hidden;
            box-shadow: 0 40px 100px rgba(0,0,0,1);
        }
        .tabs { display: flex; background: rgba(0,0,0,0.5); }
        .tab {
            flex: 1; padding: 20px 5px; text-align: center; font-size: 0.7rem;
            color: var(--text-muted); cursor: pointer; transition: 0.4s; letter-spacing: 1px;
        }
        .tab.active { color: var(--gold-primary); border-bottom: 2px solid var(--gold-primary); background: rgba(212,175,55,0.1); }

        .tab-content { padding: 30px 20px; display: none; text-align: center; }
        .tab-content.active { display: block; animation: slideIn 0.5s ease; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .mint-btn {
            width: 100%; padding: 20px; margin-top: 20px; border: none;
            background: linear-gradient(90deg, #AA8800, #D4AF37, #F9F1D0, #AA8800);
            background-size: 300% 100%; color: #000; font-family: 'Cinzel', serif;
            font-weight: 900; letter-spacing: 3px; border-radius: 10px; cursor: pointer;
            animation: goldFlow 5s infinite linear;
        }
        @keyframes goldFlow { 0% { background-position: 0% 0%; } 100% { background-position: 300% 0%; } }

        /* Gallery Grid */
        .gallery-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
            width: 100%; padding: 10px;
        }
        .gallery-item {
            aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 10px;
            border: 1px solid var(--glass-border); overflow: hidden; transition: 0.4s;
        }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }
        .gallery-item:hover { transform: scale(1.05); border-color: var(--gold-primary); }

        /* Stats & Panels */
        .stat-card {
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 20px; margin-bottom: 20px; width: 100%;
        }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .stat-label { color: var(--text-muted); font-size: 0.8rem; }
        .stat-value { color: var(--gold-primary); font-weight: 700; }

        .back-btn {
            position: absolute; top: 30px; left: 20px; background: none;
            border: 1px solid var(--gold-primary); color: var(--gold-primary);
            padding: 8px 15px; font-family: 'Cinzel'; cursor: pointer; z-index: 100;
        }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    
    <div class="nav-trigger" onclick="toggleMenu()">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>

    <div class="bottom-nav-bar" id="bottomNav">
        <div class="nav-item" onclick="handleMenuClick('panel')">PANEL</div>
        <div class="nav-item" onclick="handleMenuClick('hall')">HALL</div>
        <div class="nav-item" onclick="handleMenuClick('market')">MARKET</div>
        <div class="nav-item" onclick="handleMenuClick('gallery')">GALLERY</div>
        <div class="nav-item" onclick="handleMenuClick('rituals')">RITUALS</div>
        <div class="nav-item" onclick="handleMenuClick('settings')">SETTINGS</div>
    </div>

    <div id="step1" class="stage">
        <h1 class="main-title">THE VOID</h1>
        <div class="input-wrapper">
            <input type="text" id="sacrifice" class="sacrifice-input" placeholder="NAME YOUR BURDEN" maxlength="40">
        </div>
        <button class="ascend-btn" onclick="ascend()">ASCEND</button>
    </div>

    <div id="step2" class="stage" style="display:none; opacity:0;">
        <div class="glass-card">
            <div class="tabs">
                <div class="tab active" onclick="setTab('eternal')">ETERNAL</div>
                <div class="tab" onclick="setTab('divine')">DIVINE</div>
                <div class="tab" onclick="setTab('celestial')">CELESTIAL</div>
                <div class="tab" onclick="setTab('legendary')">LEGENDARY</div>
            </div>
            <div id="eternal" class="tab-content active">
                <div style="font-size:2rem; margin-bottom:10px;">FREE</div>
                <p style="color:var(--text-muted); font-size:0.8rem; margin-bottom:20px;">Limit: 3/Day</p>
                <button class="mint-btn" onclick="mint('eternal')">MINT ETERNAL</button>
            </div>
            <div id="divine" class="tab-content">
                <div style="font-size:2rem; margin-bottom:10px;">150 ‚≠ê</div>
                <button class="mint-btn" onclick="mint('divine')">MINT DIVINE</button>
            </div>
            <div id="celestial" class="tab-content">
                <div style="font-size:2rem; margin-bottom:10px;">299 ‚≠ê</div>
                <button class="mint-btn" onclick="mint('celestial')">MINT CELESTIAL</button>
            </div>
            <div id="legendary" class="tab-content">
                <div style="font-size:2rem; margin-bottom:10px;">499 ‚≠ê</div>
                <button class="mint-btn" onclick="mint('legendary')">MINT LEGENDARY</button>
            </div>
        </div>
    </div>
    <div id="panelSection" class="section-container">
        <button class="back-btn" onclick="showMinting()">‚Üê BACK</button>
        <h2 class="section-title">MY PANEL</h2>
        <div class="stat-card">
            <div class="stat-row">
                <span class="stat-label">RANK:</span>
                <span class="stat-value">NEOPHYTE</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">ASCENSIONS:</span>
                <span class="stat-value" id="totalAscensions">0</span>
            </div>
        </div>
        <div class="gallery-grid" id="panel-gallery"></div>
    </div>

    <div id="gallerySection" class="section-container">
        <button class="back-btn" onclick="showMinting()">‚Üê BACK</button>
        <h2 class="section-title">THE VOID GALLERY</h2>
        <div class="gallery-grid" id="main-gallery"></div>
    </div>

    <div id="hallSection" class="section-container">
        <button class="back-btn" onclick="showMinting()">‚Üê BACK</button>
        <h2 class="section-title">HALL OF FAME</h2>
        <p style="text-align:center; color:var(--text-muted);">THE HIGHEST ASCENSIONS ARE LISTED HERE.</p>
    </div>

    <div id="marketSection" class="section-container">
        <button class="back-btn" onclick="showMinting()">‚Üê BACK</button>
        <h2 class="section-title">ARTIFACT MARKET</h2>
        <p style="text-align:center; color:var(--text-muted);">COMING SOON FROM THE VOID.</p>
    </div>

    <div id="settingsSection" class="section-container">
        <button class="back-btn" onclick="showMinting()">‚Üê BACK</button>
        <h2 class="section-title">SETTINGS</h2>
        <div class="stat-card">
            <p style="color:var(--gold-primary);">AUDIO: ON</p>
            <p style="color:var(--gold-primary);">HAPTIC: ON</p>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- 150 PROMPTS LOGIC (ÿ™ŸÖÿßŸÖ Ÿæÿ±ÿßŸÖŸæÿ™‚ÄåŸáÿß ÿß€åŸÜÿ¨ÿß ŸÑŸàÿØ ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ) ---
        const VOID_PROMPTS = [
            "Ancient deity in golden armor, void background", 
            "Ethereal soul ascending to starlight",
            "Celestial architecture, gold and black marble",
            "Sacred geometry patterns in liquid gold",
            "The eye of the void watching over a golden empire",
            "Cybernetic god with golden circuitry",
            "Astral projection through a dark nebula",
            // ... (ÿØÿ± ŸÅÿß€åŸÑ ŸÜŸáÿß€å€å ÿ¥ŸÖÿß ÿ™ŸÖÿßŸÖ 150 ŸÖŸàÿ±ÿØ ÿß€åŸÜÿ¨ÿß ŸÇÿ±ÿßÿ± ŸÖ€å‚Äå⁄Ø€åÿ±ÿØ) ...
            "Mythical phoenix made of dark matter and gold"
        ];

        // --- PARTICLE SYSTEM (ŸÑÿßÿ¨€å⁄© ⁄©ÿßŸÖŸÑ ÿ∞ÿ±ÿßÿ™) ---
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', initCanvas);
        initCanvas();

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 1.5 + 0.5;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.color = Math.random() > 0.5 ? 'rgba(212, 175, 55,' : 'rgba(255, 255, 255,';
                this.alpha = Math.random() * 0.6 + 0.2;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }
            draw() {
                ctx.fillStyle = this.color + this.alpha + ')';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        for (let i = 0; i < 250; i++) particles.push(new Particle());

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // --- APP NAVIGATION LOGIC ---
        function toggleMenu() {
            document.querySelector('.nav-trigger').classList.toggle('active');
            document.getElementById('bottomNav').classList.toggle('active');
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        }

        function handleMenuClick(section) {
            document.querySelectorAll('.stage, .section-container').forEach(el => el.style.display = 'none');
            const target = document.getElementById(section + 'Section');
            if (target) {
                target.style.display = 'flex';
                // ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ™ÿµÿßŸà€åÿ± ÿØÿ± ŸáŸÜ⁄ØÿßŸÖ ⁄©ŸÑ€å⁄© ÿ®ÿ± ÿ±Ÿà€å ⁄ØÿßŸÑÿ±€å €åÿß ŸæŸÜŸÑ
                if (section === 'gallery' || section === 'panel') loadGallery();
            }
            toggleMenu();
        }

        function ascend() {
            const burden = document.getElementById('sacrifice').value;
            if (!burden) return tg.showAlert("PLEASE NAME YOUR BURDEN...");
            document.getElementById('step1').style.display = 'none';
            const s2 = document.getElementById('step2');
            s2.style.display = 'flex';
            setTimeout(() => s2.style.opacity = '1', 10);
        }

        function setTab(plan) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(plan).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function showMinting() {
            document.querySelectorAll('.section-container').forEach(el => el.style.display = 'none');
            document.getElementById('step2').style.display = 'flex';
        }

        // --- BACKEND CONNECTION LOGIC (ÿ±ŸÅÿπ ŸÖÿ¥⁄©ŸÑ ⁄ØÿßŸÑÿ±€å Ÿà ŸÖ€åŸÜÿ™) ---
        async function mint(planType) {
            const burden = document.getElementById('sacrifice').value;
            const userId = tg.initDataUnsafe.user?.id || 0;

            tg.MainButton.setText("FORGING IN THE VOID...");
            tg.MainButton.show();

            try {
                const response = await fetch('/api/mint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ u: userId, b: burden, type: planType })
                });

                if (response.ok) {
                    tg.showAlert("üî± THE VOID HAS ACCEPTED YOUR SACRIFICE.");
                    loadGallery(); // ÿ¢ŸæÿØ€åÿ™ ŸÅŸàÿ±€å ⁄ØÿßŸÑÿ±€å
                } else {
                    tg.showAlert("THE VOID IS TEMPORARILY CLOSED.");
                }
            } catch (e) {
                tg.showAlert("COMMUNICATION WITH THE VOID FAILED.");
            }
            tg.MainButton.hide();
        }

        async function loadGallery() {
            const userId = tg.initDataUnsafe.user?.id || 0;
            const grids = [document.getElementById('main-gallery'), document.getElementById('panel-gallery')];

            try {
                const response = await fetch(`/api/gallery/${userId}`);
                const data = await response.json();

                if (data.images && data.images.length > 0) {
                    const html = data.images.map(img => `
                        <div class="gallery-item">
                            <img src="${img.url}" loading="lazy">
                        </div>
                    `).join('');
                    
                    grids.forEach(grid => { if(grid) grid.innerHTML = html; });
                    document.getElementById('totalAscensions').innerText = data.images.length;
                } else {
                    grids.forEach(grid => { if(grid) grid.innerHTML = "<p style='grid-column: 1/4; text-align:center;'>EMPTY VOID</p>"; });
                }
            } catch (e) {
                console.log("Gallery synchronization failed.");
            }
        }
    </script>
</body>
</html>

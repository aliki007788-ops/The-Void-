<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>THE VOID</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        body, html { margin: 0; padding: 0; background: #000; color: #fff; font-family: 'Cinzel', serif; overflow: hidden; height: 100%; }
        
        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        
        .stage { position: relative; z-index: 10; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 1s; }
        
        /* صفحه اول */
        .main-title { font-size: 3.5rem; letter-spacing: 15px; color: #D4AF37; text-shadow: 0 0 20px #D4AF37; margin-bottom: 40px; }
        .sacrifice-area { width: 85%; height: 120px; background: rgba(10,10,10,0.8); border: 1px solid #D4AF37; color: #fff; padding: 15px; border-radius: 10px; font-family: 'Tahoma'; margin-bottom: 40px; resize: none; text-align: center; }
        
        .explode-btn { background: none; border: 2px solid #D4AF37; color: #D4AF37; padding: 20px 80px; font-size: 1.8rem; cursor: pointer; transition: 0.5s; letter-spacing: 5px; }
        .explode-btn:hover { background: #D4AF37; color: #000; box-shadow: 0 0 40px #D4AF37; }

        /* صفحه دوم: کارت‌های شیشه‌ای */
        .glass-container { display: none; opacity: 0; width: 90%; max-width: 400px; text-align: center; transition: 1s; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 20px; padding: 25px; margin-bottom: 20px; position: relative; }
        
        .tab-price { color: #D4AF37; font-size: 1.4rem; margin-top: 5px; }
        .preview-circle { width: 70px; height: 70px; border-radius: 50%; border: 2px solid #D4AF37; margin: 15px auto; background-size: cover; background-position: center; display: none; box-shadow: 0 0 15px #D4AF37; }
        
        .select-btn { background: transparent; border: 1px solid #D4AF37; color: #D4AF37; padding: 12px 40px; border-radius: 25px; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .select-btn:hover { background: #D4AF37; color: #000; box-shadow: 0 0 20px #D4AF37; }

        .luck-btn { background: linear-gradient(45deg, #000, #1a1a1a); border: 2px solid #D4AF37; color: #D4AF37; padding: 15px; width: 100%; border-radius: 15px; font-weight: bold; animation: pulse 2s infinite; cursor: pointer; }
        @keyframes pulse { 0% { box-shadow: 0 0 5px #D4AF37; } 50% { box-shadow: 0 0 25px #D4AF37; } 100% { box-shadow: 0 0 5px #D4AF37; } }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div id="stage1" class="stage">
        <h1 class="main-title">THE VOID</h1>
        <textarea id="burden" class="sacrifice-area" placeholder="بار خود را اینجا بنویسید..."></textarea>
        <button class="explode-btn" onclick="goExplode()">ASCEND</button>
    </div>

    <div id="stage2" class="stage glass-container">
        <h2 id="dynamicTitle" style="color:#D4AF37; letter-spacing:5px;">SELECTION</h2>
        
        <div class="glass-card">
            <h3 style="margin:0;">VAGABOND</h3>
            <div class="tab-price">139 STARS</div>
            <div id="p1" class="preview-circle"></div>
            <button class="select-btn" onclick="document.getElementById('f1').click()">ADD PHOTO</button>
            <input type="file" id="f1" hidden onchange="preview(this, 'p1')">
            <button class="select-btn" onclick="pay('Vagabond')">CHOOSE</button>
        </div>

        <div class="glass-card">
            <h3 style="margin:0;">IMPERIAL</h3>
            <div class="tab-price">299 STARS</div>
            <div id="p2" class="preview-circle"></div>
            <button class="select-btn" onclick="document.getElementById('f2').click()">ADD PHOTO</button>
            <input type="file" id="f2" hidden onchange="preview(this, 'p2')">
            <button class="select-btn" onclick="pay('Imperial')">CHOOSE</button>
        </div>

        <button class="luck-btn" onclick="pay('Luck')">KING'S LUCK (249 STARS)</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // سیستم ذرات معلق
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let dots = [];
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;

        for(let i=0; i<100; i++) dots.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: Math.random()-0.5, vy: Math.random()-0.5});

        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "#D4AF37";
            dots.forEach(d => {
                d.x += d.vx; d.y += d.vy;
                if(d.x<0 || d.x>canvas.width) d.vx*=-1;
                if(d.y<0 || d.y>canvas.height) d.vy*=-1;
                ctx.beginPath(); ctx.arc(d.x, d.y, 1.5, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(draw);
        }
        draw();

        function goExplode() {
            if(!document.getElementById('burden').value) return tg.showAlert("کلمات شما فداکاریِ شماست...");
            
            // انیمیشن انفجار ذرات
            dots.forEach(d => { d.vx *= 30; d.vy *= 30; });
            
            document.getElementById('stage1').style.opacity = 0;
            setTimeout(() => {
                document.getElementById('stage1').style.display = 'none';
                document.getElementById('stage2').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('stage2').style.opacity = 1;
                    // تجمع ذرات در پس‌زمینه
                    dots.forEach(d => { d.vx /= 30; d.vy /= 30; });
                }, 50);
            }, 800);
        }

        function preview(input, id) {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = e => {
                    const el = document.getElementById(id);
                    el.style.backgroundImage = `url(${e.target.result})`;
                    el.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        }
        
        async function pay(lvl) {
            // منطق ارسال به main.py...
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>THE VOID</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #000; color: #FFD700; font-family: monospace; text-align: center; margin: 0; overflow: hidden; }
        .ui { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 1s; }
        input[type="text"] { background: none; border: none; border-bottom: 2px solid #333; color: #FFD700; font-size: 1.4rem; text-align: center; width: 80%; outline: none; }
        .btn { border: 2px solid #FFD700; padding: 15px 50px; margin-top: 40px; background: none; color: #FFD700; cursor: pointer; letter-spacing: 4px; }
        #loader { position: fixed; top: 0; width: 100%; height: 100%; background: #000; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        canvas { position: fixed; top: 0; left: 0; z-index: -1; }
    </style>
</head>
<body>
    <canvas id="cvs"></canvas>
    <audio id="snd" src="ascend.mp3"></audio>
    <div class="ui" id="main-ui">
        <h1 style="letter-spacing: 10px;">THE VOID</h1>
        <input type="text" id="inp" placeholder="YOUR SACRIFICE" maxlength="15">
        <div style="margin-top: 30px; padding: 10px; border: 1px dashed #444; border-radius: 10px;">
            <input type="file" id="f-up" accept="image/*"><br><br>
            <label><input type="checkbox" id="c-prof"> USE PROFILE PHOTO</label>
        </div>
        <button class="btn" onclick="ignite()">SACRIFICE</button>
    </div>
    <div id="loader">
        <h2 id="grade-title">ANALYZING...</h2>
        <h1 id="price-tag" style="font-size: 3rem;"></h1>
    </div>
    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        // Star Background Animation
        const c = document.getElementById('cvs'); const ctx = c.getContext('2d');
        function res() { c.width = innerWidth; c.height = innerHeight; }
        window.onresize = res; res();
        let s = Array.from({length: 100}, () => ({x: Math.random()*c.width, y: Math.random()*c.height, r: Math.random()*2}));
        function draw() {
            ctx.fillStyle = 'black'; ctx.fillRect(0,0,c.width,c.height);
            ctx.fillStyle = 'white'; s.forEach(p => { ctx.fillRect(p.x, p.y, p.r, p.r); p.y -= 0.5; if(p.y<0) p.y=c.height; });
            requestAnimationFrame(draw);
        }
        draw();

        async function ignite() {
            const b = document.getElementById('inp').value.trim(); if(!b) return;
            document.getElementById('snd').play(); tg.HapticFeedback.impactOccurred('heavy');
            document.getElementById('main-ui').style.opacity = 0;
            const loader = document.getElementById('loader'); loader.style.display = 'flex';
            
            const isPrem = document.getElementById('f-up').files[0] || document.getElementById('c-prof').checked;
            setTimeout(() => {
                document.getElementById('grade-title').innerText = isPrem ? "DIVINE GRADE" : "ETERNAL GRADE";
                document.getElementById('price-tag').innerText = isPrem ? "120 ðŸ’Ž" : "70 ðŸ’Ž";
            }, 1500);

            setTimeout(async () => {
                let pData = null; const file = document.getElementById('f-up').files[0];
                if(file) {
                    pData = await new Promise(r => {
                        const rd = new FileReader(); rd.onload = e => {
                            const img = new Image(); img.onload = () => {
                                const cv = document.createElement('canvas'); cv.width=600; cv.height=600;
                                cv.getContext('2d').drawImage(img,0,0,600,600); r(cv.toDataURL('image/jpeg', 0.7));
                            }; img.src = e.target.result;
                        }; rd.readAsDataURL(file);
                    });
                }
                const payload = btoa(JSON.stringify({ u: tg.initDataUnsafe.user.id, b: b, p: pData, prof: document.getElementById('c-prof').checked }));
                const res = await fetch(`/create_stars_invoice?d=${payload}`);
                const j = await res.json();
                if(j.free) { tg.showAlert("GIFT GRANTED."); tg.close(); }
                else if(j.url) tg.openInvoice(j.url, s => tg.close());
            }, 4000);
        }
    </script>
</body>
</html>

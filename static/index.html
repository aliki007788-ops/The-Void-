<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE VOID</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; color: #FFD700; font-family: 'Cinzel', serif; }
        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        .stage { position: relative; z-index: 10; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; transition: opacity 1s ease; box-sizing: border-box; }
        
        /* ØªØ§ÛŒØªÙ„ Ùˆ ÙˆØ±ÙˆØ¯ÛŒ */
        .main-title { font-size: 2.8rem; letter-spacing: 18px; margin-bottom: 50px; text-shadow: 0 0 30px rgba(255,215,0,0.6); }
        input[type="text"] { background: transparent; border: none; border-bottom: 2px solid #333; color: #FFD700; font-size: 1.4rem; text-align: center; width: 80%; padding: 15px 0; outline: none; margin-bottom: 30px; }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ - ØªØ±Ø§Ø² Ø´Ø¯Ù‡ Ø¯Ø± ÙˆØ³Ø· */
        .btn-container { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .btn { background: transparent; border: 2px solid #FFD700; color: #FFD700; padding: 15px; width: 85%; max-width: 350px; font-size: 1.1rem; letter-spacing: 4px; cursor: pointer; transition: 0.4s; position: relative; overflow: hidden; }
        .btn:active { background: #FFD700; color: #000; }
        
        /* Ø¯Ú©Ù…Ù‡ Ø´Ø§Ù†Ø³ Ù¾Ø§Ø¯Ø´Ø§Ù‡ */
        .luck-btn { background: linear-gradient(45deg, #6200ea, #d500f9); border: none; color: white; box-shadow: 0 0 20px #d500f9; animation: pulse 1.5s infinite; font-weight: bold; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        /* ØªØ§Ø¨Ù„ÙˆÛŒ Ø§ÙØªØ®Ø§Ø±Ø§Øª */
        .hall { margin-top: 30px; width: 85%; max-width: 400px; font-size: 0.8rem; background: rgba(20,20,20,0.5); padding: 15px; border-radius: 10px; border: 1px solid #222; }
        .winner { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #333; }
        
        /* ØµÙØ­Ù‡ Ø¯ÙˆÙ… Ùˆ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ */
        #step2 { display: none; opacity: 0; }
        #photo-preview-container { margin-bottom: 20px; text-align: center; display: none; }
        #photo-preview { width: 120px; height: 120px; object-fit: cover; border-radius: 50%; border: 4px solid #FFD700; box-shadow: 0 0 30px rgba(255,215,0,0.5); }
        
        /* Ù‚ÛŒÙ…Øª Ùˆ Ø§Ù„Ù…Ø§Ø³ */
        .price { font-size: 2.5rem; margin: 15px 0; display: flex; align-items: center; gap: 10px; justify-content: center; }
        .diamond { color: #00ffff; text-shadow: 0 0 25px #00ffff; font-size: 1.2em; animation: flash 2s infinite; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div id="step1" class="stage">
        <h1 class="main-title">THE VOID</h1>
        <input type="text" id="sacrifice" placeholder="WHAT DO YOU SACRIFICE?" maxlength="50">
        <button class="btn" onclick="ascend()">ASCEND</button>
        
        <div class="hall">
            <p style="text-align:center; color:#FFD700; letter-spacing:3px;">LATEST ASCENSIONS</p>
            <div id="hall-list">Loading souls... [cite: 582, 605]</div>
        </div>
    </div>

    <div id="step2" class="stage">
        <div id="photo-preview-container">
            <img id="photo-preview" />
            <p style="font-size: 0.8rem; margin-top: 5px;">SOUL IMAGE DETECTED</p>
        </div>

        <div class="price"><span id="amount">150</span><span class="diamond">ğŸ’</span></div>

        <div class="btn-container">
            <button class="btn luck-btn" onclick="mint('kings-luck')">KING'S LUCK (199 â­)</button>
            <button class="btn" onclick="mint('divine')">DIVINE (150 â­)</button>
            <button class="btn" onclick="mint('celestial')">CELESTIAL (299 â­)</button>
            <button class="btn" onclick="mint('legendary')">LEGENDARY (499 â­)</button>
            
            <label style="border:1px dashed #444; padding:10px; width:85%; text-align:center; cursor:pointer; font-size:0.9rem;">
                UPLOAD SOUL PHOTO
                <input type="file" id="upload" accept="image/*" style="display:none;" onchange="checkPreview()">
            </label>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let particles = [], state = 'idle';

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø¨Ù„ÙˆÛŒ Ø§ÙØªØ®Ø§Ø±Ø§Øª (10ØªØ§ÛŒ Ø¢Ø®Ø±)
        async function loadHall() {
            try {
                const res = await fetch('/api/hall-of-fame'); // [cite: 607, 851]
                const data = await res.json();
                const list = document.getElementById('hall-list');
                list.innerHTML = '';
                data.winners.slice(-10).reverse().forEach(w => { // [cite: 611]
                    list.innerHTML += `<div class="winner"><span>${w.user_id}</span><span>${w.level}</span></div>`;
                });
            } catch(e) { document.getElementById('hall-list').innerText = "The Void is quiet..."; }
        }
        loadHall();

        function checkPreview() {
            const file = document.getElementById('upload').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('photo-preview').src = e.target.result;
                    document.getElementById('photo-preview-container').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø§Ù†ÙØ¬Ø§Ø± Ùˆ ØªØ´Ú©ÛŒÙ„ Ù…ØªÙ†
        function ascend() {
            const sac = document.getElementById('sacrifice').value;
            if(!sac) return tg.showAlert("Name your sacrifice.");
            
            state = 'exploding';
            for(let i=0; i<400; i++) {
                particles.push({
                    x: canvas.width/2, y: canvas.height/2,
                    vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20,
                    size: Math.random()*5+2, color: '#FFD700'
                });
            }
            
            document.getElementById('step1').style.opacity = 0;
            setTimeout(() => {
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'flex';
                setTimeout(() => document.getElementById('step2').style.opacity = 1, 100);
            }, 800);
        }

        async function mint(type) {
            const sac = document.getElementById('sacrifice').value;
            const file = document.getElementById('upload').files[0];
            let photoBase64 = null;

            if(file) {
                photoBase64 = await new Promise(r => {
                    const reader = new FileReader();
                    reader.onload = e => r(e.target.result);
                    reader.readAsDataURL(file);
                });
            }

            const res = await fetch('/create_stars_invoice', { // [cite: 834]
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    u: tg.initDataUnsafe.user?.id, 
                    b: sac, 
                    type: type, 
                    p: photoBase64 
                })
            });
            const data = await res.json();
            if(data.url) tg.openInvoice(data.url); // [cite: 648]
        }

        function draw() {
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.fillRect(0,0,canvas.width, canvas.height);
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
                p.size *= 0.98;
                if(p.size < 0.5) particles.splice(i, 1);
            });
            requestAnimationFrame(draw);
        }
        draw();
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    </script>
</body>
</html>

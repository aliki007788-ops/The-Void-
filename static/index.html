<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE VOID 2040</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #FFD700; --deep: #050508; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--deep); font-family: 'Inter', sans-serif; }
        
        #canvas { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none; }

        /* UI مرکزی */
        #ui-layer { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; transition: 1.5s; }
        h1 { color: var(--gold); letter-spacing: 1.5rem; font-weight: 100; font-size: 2.5rem; margin-bottom: 2rem; text-shadow: 0 0 50px rgba(255, 215, 0, 0.5); }
        input { background: transparent; border: none; border-bottom: 1px solid #333; color: var(--gold); font-size: 1.5rem; text-align: center; width: 70%; outline: none; padding: 1rem; margin-bottom: 3rem; letter-spacing: 2px; }

        .ritual-trigger { 
            background: transparent; color: var(--gold); border: 1px solid var(--gold); 
            padding: 1.5rem 4rem; font-size: 1rem; letter-spacing: 5px; cursor: pointer; 
            transition: 0.5s; backdrop-filter: blur(10px);
        }

        /* دکمه نهایی سینمایی */
        #action-layer { 
            position: absolute; bottom: 15%; width: 100%; display: none; 
            justify-content: center; z-index: 100; opacity: 0; 
        }
        .mint-btn { 
            background: linear-gradient(135deg, #FFD700, #B8860B); color: black; 
            border: none; padding: 1.5rem 3rem; font-weight: 900; font-size: 0.9rem; 
            letter-spacing: 3px; cursor: pointer; border-radius: 5px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.4); pointer-events: auto;
        }

        .shake { animation: bigBang 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes bigBang { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-8px, 0, 0); } 40%, 60% { transform: translate3d(8px, 0, 0); } }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div id="ui-layer">
        <h1>THE VOID</h1>
        <input type="text" id="input-field" placeholder="GIVE IT TO THE STARS" autocomplete="off">
        <button class="ritual-trigger" onclick="initiateBigBang()">SACRIFICE</button>
    </div>

    <div id="action-layer">
        <button class="mint-btn" onclick="executeMint()">MINT ETERNAL PROOF ($1)</button>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    let particles = [];
    let nebula = [];
    let state = 'idle';

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // ایجاد ابرهای سحابی رنگی متحرک
    for(let i=0; i<8; i++) {
        nebula.push({
            x: Math.random()*canvas.width, y: Math.random()*canvas.height,
            r: Math.random()*400+200,
            c: `hsla(${Math.random()*360}, 50%, 15%, 0.1)`,
            vx: (Math.random()-0.5)*0.5, vy: (Math.random()-0.5)*0.5
        });
    }

    class Particle {
        constructor(x, y, tx, ty) {
            this.x = x; this.y = y;
            this.tx = tx; this.ty = ty;
            this.originX = canvas.width/2; // انفجار از مرکز
            this.originY = canvas.height/2;
            this.vx = (Math.random() - 0.5) * 100;
            this.vy = (Math.random() - 0.5) * 100;
            this.friction = 0.92;
            this.size = Math.random() * 2 + 0.5;
            this.color = Math.random() > 0.2 ? '#FFD700' : '#FFF';
        }
        update() {
            if (state === 'exploding') {
                this.vx *= this.friction; this.vy *= this.friction;
                this.x += this.vx; this.y += this.vy;
            } else if (state === 'morphing') {
                this.x += (this.tx - this.x) * 0.06;
                this.y += (this.ty - this.y) * 0.06;
                this.size = 1.2; // ذرات در جمله کمی بزرگتر و ثابت می‌شوند
            }
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill();
        }
    }

    function getPoints(text, size) {
        const tC = document.createElement('canvas');
        const tX = tC.getContext('2d');
        tC.width = canvas.width; tC.height = canvas.height;
        tX.fillStyle = 'white';
        tX.font = `bold ${size}px serif`;
        tX.textAlign = 'center'; tX.textBaseline = 'middle';
        tX.fillText(text, canvas.width/2, canvas.height/2);
        const data = tX.getImageData(0,0,canvas.width,canvas.height).data;
        const pts = [];
        // افزایش تراکم برای وضوح فوق‌العاده
        for(let y=0; y<canvas.height; y+=2) {
            for(let x=0; x<canvas.width; x+=2) {
                if(data[(y*canvas.width+x)*4+3] > 128) pts.push({x,y});
            }
        }
        return pts;
    }

    function initiateBigBang() {
        const val = document.getElementById('input-field').value;
        if(!val) return;

        tg.HapticFeedback.notificationOccurred('success');
        document.body.classList.add('shake');
        document.getElementById('ui-layer').style.opacity = '0';
        document.getElementById('ui-layer').style.pointerEvents = 'none';

        const endPts = getPoints("ETERNAL PEACE", 80); // جمله نهایی بسیار واضح
        
        // ذرات از مرکز متولد می‌شوند
        particles = endPts.map(p => {
            return new Particle(canvas.width/2, canvas.height/2, p.x, p.y);
        });

        state = 'exploding';
        
        setTimeout(() => {
            document.body.classList.remove('shake');
            state = 'morphing';
            setTimeout(() => {
                const al = document.getElementById('action-layer');
                al.style.display = 'flex';
                setTimeout(() => al.style.opacity = '1', 100);
            }, 3000);
        }, 800);
    }

    function animate() {
        ctx.fillStyle = '#050508';
        ctx.fillRect(0,0,canvas.width, canvas.height);

        // رسم سحابی متحرک
        nebula.forEach(n => {
            n.x += n.vx; n.y += n.vy;
            const g = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.r);
            g.addColorStop(0, n.c); g.addColorStop(1, 'transparent');
            ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width, canvas.height);
        });

        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }
    animate();

    function executeMint() {
        const val = document.getElementById('input-field').value;
        tg.sendData(JSON.stringify({action: "create_invoice", need: val}));
    }
</script>
</body>
</html>
